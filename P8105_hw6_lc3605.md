Homework \#6
================
Lynn Chen

## Problem 1:

``` r
birthweight = read_csv("./data/birthweight.csv")
```

    ## Rows: 4342 Columns: 20

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## Clean the data 

birthweight = birthweight %>% 
  janitor::clean_names() %>% 
  mutate(
    babysex = factor(babysex, levels = c("1", "2")),
    babysex = fct_recode(babysex, "Female" = "2", "Male" = "1"),
    frace = factor(frace, 
                       levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9")),
    frace = fct_recode(frace, 
                       "White" = "1",
                       "Black" = "2",
                       "Asian" = "3",
                       "Puerto Rican" = "4", 
                       "Other" = "8",
                       "Unknown" = "9"),
    malform = factor(malform, labels = c("Absent", "Present")),
    mrace = factor(mrace,  c(1, 2, 3, 4, 8)),
    mrace = fct_recode(mrace, 
                       "White" = "1",
                       "Black" = "2",
                       "Asian" = "3",
                       "Puerto Rican" = "4", 
                       "Other" = "8"))

## check for missing values
apply(is.na(birthweight),2,sum)
```

    ##  babysex    bhead  blength      bwt    delwt  fincome    frace  gaweeks 
    ##        0        0        0        0        0        0        0        0 
    ##  malform menarche  mheight   momage    mrace   parity  pnumlbw  pnumsga 
    ##        0        0        0        0        0        0        0        0 
    ##    ppbmi     ppwt   smoken   wtgain 
    ##        0        0        0        0

``` r
sum(!complete.cases(birthweight))
```

    ## [1] 0

-   This dataset contains 4342 rows and 20 columns. There are no missing
    values in the data!! YAY!

For the regression model, in order to choose more meaningful set of
predictors for the ultimal model I use stepwise regression with backward
selection.

``` r
model_1 = 
  lm(bwt ~ ., data = birthweight) %>% 
  step(direction = "backward", trace = 0) %>% 
  broom::tidy() %>% 
  knitr::kable()
```

The chosen model include predictors:`babysex`, `bhead`, `blength`,
`delwt`, `fincome`, `gaweeks`, `mheight`, `mrace`, `parity`, `ppwt`, and
`smoken`.

``` r
fit = lm(bwt ~ babysex + bhead + blength + delwt + fincome + gaweeks + mheight + mrace + parity + ppwt + smoken, data = birthweight) 
summary(fit)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ babysex + bhead + blength + delwt + fincome + 
    ##     gaweeks + mheight + mrace + parity + ppwt + smoken, data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1097.18  -185.52    -3.39   174.14  2353.44 
    ## 
    ## Coefficients:
    ##                     Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)       -6098.8219   137.5463 -44.340  < 2e-16 ***
    ## babysexFemale        28.5580     8.4549   3.378 0.000737 ***
    ## bhead               130.7770     3.4466  37.944  < 2e-16 ***
    ## blength              74.9471     2.0190  37.120  < 2e-16 ***
    ## delwt                 4.1067     0.3921  10.475  < 2e-16 ***
    ## fincome               0.3180     0.1747   1.820 0.068844 .  
    ## gaweeks              11.5925     1.4621   7.929 2.79e-15 ***
    ## mheight               6.5940     1.7849   3.694 0.000223 ***
    ## mraceBlack         -138.7925     9.9071 -14.009  < 2e-16 ***
    ## mraceAsian          -74.8868    42.3146  -1.770 0.076837 .  
    ## mracePuerto Rican  -100.6781    19.3247  -5.210 1.98e-07 ***
    ## parity               96.3047    40.3362   2.388 0.017004 *  
    ## ppwt                 -2.6756     0.4274  -6.261 4.20e-10 ***
    ## smoken               -4.8434     0.5856  -8.271  < 2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 272.3 on 4328 degrees of freedom
    ## Multiple R-squared:  0.7181, Adjusted R-squared:  0.7173 
    ## F-statistic: 848.1 on 13 and 4328 DF,  p-value: < 2.2e-16

``` r
birthweight %>% 
    add_predictions(fit) %>% 
    add_residuals(fit) %>% 
    ggplot(aes(x = pred, y = resid)) +
    geom_point(alpha = 0.2)  + 
    geom_smooth(se = F, color = "red", method = "lm", size = 1, linetype = 2) + 
    labs(title = "Residuals vs. Predicted Values", 
       x = "Predicted", 
       y = "Residuals")
```

    ## `geom_smooth()` using formula 'y ~ x'

<img src="P8105_hw6_lc3605_files/figure-gfm/fit model-1.png" width="90%" />

According to the residuals against fitted values plot, the residuals are
roughly symmetrical around y = 0. The residuals seems to be evenly
distributed and the normal distribution of residuals assumption is
satisfied for linear regression. There are a few data points with low
fitted values and high residuals, majority of data points cluster around
predicted values 2500 - 4000.

### Compare models

-   **Model 2**: bwt \~ blength + gaweeks

-   **Model 3**: bwt \~ babysex + blength + bhead + babysex \* blength +
    babysex \* bhead + blength \* bhead + babysex \* blength \* bhead

``` r
model_2 = 
  lm(bwt ~ blength + gaweeks, data = birthweight) %>% 
  broom::tidy() %>% 
  knitr::kable()

model_3 = 
  lm(bwt ~ babysex * blength * bhead, data = birthweight) %>% 
  broom::tidy() %>% 
  knitr::kable()
```
